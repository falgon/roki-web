<!-- ローディング画面 -->
<div id="loading-overlay" class="loading-overlay">
    <div class="loading-content">
        <div class="loading-title">$title$</div>
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading...</div>
        <div class="loading-details" id="loading-details">Loading fonts...</div>
        <div class="progress-container">
            <div id="progress-bar" class="progress-bar"></div>
        </div>
        <div id="progress-text" class="progress-text">0%</div>
    </div>
</div>

<div class="disney-experience-summary" id="main-content">
<div class="container">
    <h1 class="disney-title">$title$</h1>
    <div class="profile-section">
        <div class="profile-image mb-3">
            <figure class="image is-128x128 mx-auto">
                <picture>
                    <source class="is-rounded" type="image/webp" srcset="../images/avator/prof1000x1000.png.webp">
                    <img alt="Profile photo" class="is-rounded" src="../images/avator/prof1000x1000.png" />
                </picture>
            </figure>
        </div>
        <div class="sns-links mb-3">
            <ul class="is-unstyled mb-0 has-text-centered">
                <li class="is-inline-block mr-4"><a href="/"><i class="fas fa-house fa-lg" aria-hidden="true"></i></a></li>
                <li class="is-inline-block mr-4"><a href="https://x.com/p0nchi_v"><i class="fab fa-x-twitter fa-lg" aria-hidden="true"></i></a></li>
                <li class="is-inline-block"><a href="https://www.instagram.com/ponchi.v/"><i class="fab fa-instagram fa-lg" aria-hidden="true"></i></a></li>
            </ul>
        </div>
    </div>
    
    
    <div class="about-section">
        $about-body$
    </div>
    
    <div class="favorites-section">
        <div class="columns">
            <div class="column pr-2">
                <div class="favorite-category">
                    <h3 class="title is-4"><i class="fas fa-film mr-2"></i>好きな作品</h3>
                    <div class="tag-list">
                        $for(favorite-works)$
                        $if(link)$
                        <span class="tag is-small custom-tag"><a href="$link$" target="_blank" rel="noopener">$text$</a></span>
                        $else$
                        <span class="tag is-small custom-tag">$text$</span>
                        $endif$
                        $endfor$
                    </div>
                </div>
            </div>
            <div class="column pr-2">
                <div class="favorite-category">
                    <h3 class="title is-4"><i class="fas fa-hat-wizard mr-2"></i>好きなキャラクタ</h3>
                    <div class="tag-list">
                        $for(favorite-characters)$
                        $if(link)$
                        <span class="tag is-small custom-tag"><a href="$link$" target="_blank" rel="noopener">$text$</a></span>
                        $else$
                        <span class="tag is-small custom-tag">$text$</span>
                        $endif$
                        $endfor$
                    </div>
                </div>
            </div>
            <div class="column pr-2">
                <div class="favorite-category">
                    <h3 class="title is-4"><i class="fas fa-horse mr-2"></i>好きなパークコンテンツ</h3>
                    <div class="tag-list">
                        $for(favorite-park-contents)$
                        $if(link)$
                        <span class="tag is-small custom-tag"><a href="$link$" target="_blank" rel="noopener">$text$</a></span>
                        $else$
                        <span class="tag is-small custom-tag">$text$</span>
                        $endif$
                        $endfor$
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 体験コーナー統合セクション -->
    <div class="experience-hub mt-4">
        <!-- タイトル行：最終更新日をタイトル右端に配置 -->
        <div class="title-wrapper mb-3">
            <h3 class="title is-4 mb-0">
                <i class="fas fa-wand-magic-sparkles"></i>体験録
            </h3>
            <div class="title-meta">
                <span class="updated-label">最終更新日:</span> $logs-last-modified$
            </div>
        </div>

        <!-- 3タブナビゲーション -->
        <div class="tabs is-boxed" role="tablist" aria-label="体験データタブ">
            <ul>
                <li class="is-active" data-tab="list">
                    <a role="tab" id="tab-list" aria-controls="panel-list" aria-selected="true" tabindex="0">
                        <span class="icon is-small"><i class="fas fa-list" aria-hidden="true"></i></span>
                        <span>一覧</span>
                    </a>
                </li>
                <li data-tab="timeline">
                    <a role="tab" id="tab-timeline" aria-controls="panel-timeline" aria-selected="false" tabindex="-1">
                        <span class="icon is-small"><i class="fas fa-calendar-days" aria-hidden="true"></i></span>
                        <span>体験タイムライン</span>
                    </a>
                </li>
                <li data-tab="tags">
                    <a role="tab" id="tab-tags" aria-controls="panel-tags" aria-selected="false" tabindex="-1">
                        <span class="icon is-small"><i class="fas fa-circle-nodes" aria-hidden="true"></i></span>
                        <span>タグ別体験頻度</span>
                    </a>
                </li>
                <li data-tab="hotels">
                    <a role="tab" id="tab-hotels" aria-controls="panel-hotels" aria-selected="false" tabindex="-1">
                        <span class="icon is-small"><i class="fas fa-bed" aria-hidden="true"></i></span>
                        <span>宿泊概算</span>
                    </a>
                </li>
            </ul>
        </div>

        <!-- Tab 1: 一覧 -->
        <div id="panel-list" class="tab-panel is-active" role="tabpanel" aria-labelledby="tab-list">
            <!-- ボタンエリア：コンテンツ数を右端に配置 -->
            <div class="list-controls mb-3">
                <div class="buttons-group">
                    <button class="button is-small is-info is-outlined ml-1" id="toggle-search-filter" aria-expanded="false" aria-controls="search-filter" aria-label="キーワード検索フィルターの表示/非表示">
                        <span class="icon" aria-hidden="true">
                            <i class="fas fa-search"></i>
                        </span>
                        <span>キーワード検索</span>
                    </button>
                    <button class="button is-small is-info is-outlined ml-1" id="toggle-tag-filter" aria-expanded="false" aria-controls="tag-filter" aria-label="タグ絞り込みフィルターの表示/非表示">
                        <span class="icon" aria-hidden="true">
                            <i class="fas fa-filter"></i>
                        </span>
                        <span>タグで絞り込み</span>
                    </button>
                </div>
                <div class="content-count">
                    <span class="total-label">コンテンツ数:</span> $logs-total-count$
                </div>
            </div>
            <div class="search-filter mb-3" id="search-filter" style="display: none;">
                <input
                    type="text"
                    id="search-input"
                    class="input is-small"
                    placeholder="検索..."
                    aria-label="体験歴を検索"
                />
            </div>
            <div class="tag-filter mb-3" id="tag-filter" style="display: none;">
                <div class="tag-filter-buttons">
                    $for(unique-tags)$
                    <button class="button is-small is-outlined tag-filter-btn" data-tag="$name$" style="border-color: $color$; color: $color$; --tag-color: $color$;">
                        <span class="icon">
                            <i class="fas fa-tag"></i>
                        </span>
                        <span>$name$</span>
                    </button>
                    $endfor$
                </div>
                <div class="selected-tags mt-2" style="display: none;">
                    <span class="is-size-7 has-text-grey">選択中: </span>
                    <span class="selected-tags-list"></span>
                    <button class="button is-small is-danger is-outlined ml-2" id="clear-selection">
                        <span class="icon">
                            <i class="fas fa-xmark"></i>
                        </span>
                        <span>クリア</span>
                    </button>
                </div>
            </div>
            <div class="logs">
                $for(disney-logs)$
                <article class="log-entry" data-date="$date$" data-tags="$for(disney-tags-list)$$name$$sep$,$endfor$" data-search-content="$title$ $log-body-text$">
                    <div class="log-title-row">
                        <h2 class="log-title">$title$</h2>
                        $for(ai-generated-badges)$
                        <span class="ai-generated-badge">
                            <i class="fas fa-robot"></i> $badge-text$
                        </span>
                        $endfor$
                    </div>
                    $if(disney-tags-list)$
                    <div class="log-tags">
                        $for(disney-tags-list)$
                        <span class="tag is-small" style="background-color: $color$; color: white;">
                            <a href="$link$" target="_blank" rel="noopener">$name$</a>
                        </span>
                        $endfor$
                    </div>
                    $endif$
                    <div class="log-date">
                        <span>$date$</span>
                        $if(youtube-links)$
                        $for(youtube-links)$
                        <a href="$url$" target="_blank" rel="noopener" title="YouTube"><i class="fab fa-youtube fa-sm"></i></a>
                        $endfor$
                        $endif$
                        $if(instagram-links)$
                        $for(instagram-links)$
                        <a href="$url$" target="_blank" rel="noopener" title="Instagram"><i class="fab fa-instagram fa-sm"></i></a>
                        $endfor$
                        $endif$
                        $if(x-links)$
                        $for(x-links)$
                        <a href="$url$" target="_blank" rel="noopener" title="X (Twitter)"><i class="fab fa-x-twitter fa-sm"></i></a>
                        $endfor$
                        $endif$
                        $if(note-links)$
                        $for(note-links)$
                        <a href="$url$" target="_blank" rel="noopener" title="Note"><i class="fas fa-note-sticky fa-sm"></i></a>
                        $endfor$
                        $endif$
                    </div>
                    <div class="log-content-row">
                        <div class="log-body">$log-body$</div>
                        $if(image-items)$
                        <div class="log-images" data-image-slideshow>
                            <div class="log-image-viewport">
                                $for(image-items)$
                                <button
                                    type="button"
                                    class="log-image-slide"
                                    data-image-url="$url$"
                                    data-image-alt="$alt$"
                                    aria-label="体験録画像を拡大表示"
                                >
                                    <img src="$url$" alt="$alt$" loading="lazy" decoding="async" />
                                </button>
                                $endfor$
                            </div>
                            <button type="button" class="slideshow-control prev" aria-label="前の画像">
                                <i class="fas fa-chevron-left" aria-hidden="true"></i>
                            </button>
                            <button type="button" class="slideshow-control next" aria-label="次の画像">
                                <i class="fas fa-chevron-right" aria-hidden="true"></i>
                            </button>
                            <div class="slideshow-dots" role="tablist" aria-label="スライド画像の切り替え">
                                $for(image-items)$
                                <button type="button" class="slideshow-dot" aria-label="$alt$"></button>
                                $endfor$
                            </div>
                        </div>
                        $endif$
                    </div>
                </article>
                $endfor$
            </div>
        </div>

        <!-- Tab 2: 体験タイムライン -->
        <div id="panel-timeline" class="tab-panel" role="tabpanel" aria-labelledby="tab-timeline" hidden>
            <div class="visualization-container">
                <div class="timeline-header mb-3">
                    <div class="year-selector">
                        <label for="timeline-year-select" class="label is-small mr-2">年度選択:</label>
                        <div class="select is-small">
                            <select id="timeline-year-select" aria-label="タイムラインの表示年度を選択">
                            </select>
                        </div>
                    </div>
                </div>
                <div id="timeline-heatmap" class="visualization-chart"></div>
            </div>
        </div>

        <!-- Tab 3: タグ別体験頻度 -->
        <div id="panel-tags" class="tab-panel" role="tabpanel" aria-labelledby="tab-tags" hidden>
            <div class="visualization-container">
                <div id="circle-packing" class="visualization-chart" style="position: relative;"></div>
            </div>
        </div>

        <!-- Tab 4: 宿泊概算 -->
        <div id="panel-hotels" class="tab-panel" role="tabpanel" aria-labelledby="tab-hotels" hidden>
            <div class="hotel-cards">
                $for(hotel-stays)$
                <div class="hotel-card" data-hotel-code="$hotel-code$" style="border-left-color: $hotel-color$; cursor: pointer;">
                    <div class="hotel-header">
                        <span class="hotel-badge" style="background-color: $hotel-color$;">$hotel-code$</span>
                        <div class="hotel-title">
                            <span class="stays-count">$stays-count$泊</span>
                        </div>
                    </div>
                    <div class="hotel-details">
                        $hotel-details-html$
                    </div>
                </div>
                $endfor$
            </div>
        </div>
    </div>
    </div>
</div>

<div id="log-image-modal" class="log-image-modal" role="dialog" aria-modal="true" aria-hidden="true">
    <button type="button" class="log-image-modal-close" aria-label="拡大画像を閉じる">
        <i class="fas fa-xmark" aria-hidden="true"></i>
    </button>
    <button type="button" class="log-image-modal-nav prev" aria-label="前の画像">
        <i class="fas fa-chevron-left" aria-hidden="true"></i>
    </button>
    <figure class="log-image-modal-content">
        <img id="log-image-modal-img" src="" alt="" />
    </figure>
    <button type="button" class="log-image-modal-nav next" aria-label="次の画像">
        <i class="fas fa-chevron-right" aria-hidden="true"></i>
    </button>
</div>

<script>
// プレビューモードかどうかを判定
(function() {
    try {
        const lowerStr = '$is_preview$'.toLowerCase();
        window.isPreview = lowerStr === 'true';
    } catch (e) {
        window.isPreview = false;
    }
})();
</script>
