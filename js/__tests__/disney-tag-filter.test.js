"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const vitest_1=require("vitest");require("../disney-tag-filter"),(0,vitest_1.describe)("disney-tag-filter.ts",()=>{(0,vitest_1.beforeEach)(()=>{document.body.innerHTML=""}),(0,vitest_1.describe)("escapeHtml",()=>{(0,vitest_1.it)("escapes HTML special characters",()=>{(0,vitest_1.expect)(escapeHtml("<script>alert('xss')<\/script>")).toBe("&lt;script&gt;alert('xss')&lt;/script&gt;")}),(0,vitest_1.it)("escapes ampersands",()=>{(0,vitest_1.expect)(escapeHtml("Tom & Jerry")).toBe("Tom &amp; Jerry")}),(0,vitest_1.it)("does not escape quotes when using textContent",()=>{(0,vitest_1.expect)(escapeHtml('"Hello World"')).toBe('"Hello World"')}),(0,vitest_1.it)("does not escape single quotes",()=>{(0,vitest_1.expect)(escapeHtml("It's a test")).toBe("It's a test")}),(0,vitest_1.it)("handles multiple special characters",()=>{(0,vitest_1.expect)(escapeHtml('<div class="test">A & B</div>')).toBe('&lt;div class="test"&gt;A &amp; B&lt;/div&gt;')}),(0,vitest_1.it)("handles empty string",()=>{(0,vitest_1.expect)(escapeHtml("")).toBe("")}),(0,vitest_1.it)("handles normal text without special characters",()=>{(0,vitest_1.expect)(escapeHtml("Hello World")).toBe("Hello World")}),(0,vitest_1.it)("handles newlines and spaces",()=>{(0,vitest_1.expect)(escapeHtml("Line 1\nLine 2")).toBe("Line 1\nLine 2")})}),(0,vitest_1.describe)("DOM structure",()=>{(0,vitest_1.it)("can create loading overlay structure",()=>{document.body.innerHTML='\n                <div id="loading-overlay"></div>\n                <div id="main-content"></div>\n                <div id="progress-bar"></div>\n                <div id="progress-text"></div>\n                <div id="loading-details"></div>\n            ';const t=document.getElementById("loading-overlay"),e=document.getElementById("main-content"),i=document.getElementById("progress-bar"),s=document.getElementById("progress-text"),n=document.getElementById("loading-details");(0,vitest_1.expect)(t).toBeTruthy(),(0,vitest_1.expect)(e).toBeTruthy(),(0,vitest_1.expect)(i).toBeTruthy(),(0,vitest_1.expect)(s).toBeTruthy(),(0,vitest_1.expect)(n).toBeTruthy()}),(0,vitest_1.it)("can create tag filter structure",()=>{document.body.innerHTML='\n                <div id="tag-filters">\n                    <button class="tag-filter-button" data-tag="tag1">Tag 1</button>\n                    <button class="tag-filter-button" data-tag="tag2">Tag 2</button>\n                </div>\n                <div id="selected-tags-list"></div>\n                <button id="clear-selection">Clear</button>\n                <div class="log-entry" data-tags="tag1,tag2">Entry 1</div>\n                <div class="log-entry" data-tags="tag2">Entry 2</div>\n            ';const t=document.getElementById("tag-filters"),e=document.querySelectorAll(".tag-filter-button"),i=document.getElementById("clear-selection"),s=document.querySelectorAll(".log-entry");(0,vitest_1.expect)(t).toBeTruthy(),(0,vitest_1.expect)(e.length).toBe(2),(0,vitest_1.expect)(i).toBeTruthy(),(0,vitest_1.expect)(s.length).toBe(2)})}),(0,vitest_1.describe)("tag filtering logic",()=>{(0,vitest_1.beforeEach)(()=>{document.body.innerHTML='\n                <div class="log-entry" data-tags="tag1,tag2">Entry 1</div>\n                <div class="log-entry" data-tags="tag2,tag3">Entry 2</div>\n                <div class="log-entry" data-tags="tag1">Entry 3</div>\n            '}),(0,vitest_1.it)("filters entries by single tag",()=>{const t=document.querySelectorAll(".log-entry"),e=Array.from(t).filter(t=>{const e=t.getAttribute("data-tags");return e?.includes("tag1")});(0,vitest_1.expect)(e.length).toBe(2)}),(0,vitest_1.it)("filters entries by multiple tags (AND condition)",()=>{const t=document.querySelectorAll(".log-entry"),e=["tag1","tag2"],i=Array.from(t).filter(t=>{const i=t.getAttribute("data-tags");if(!i)return!1;const s=i.split(",").map(t=>t.trim());return e.every(t=>s.includes(t))});(0,vitest_1.expect)(i.length).toBe(1)})}),(0,vitest_1.describe)("normalizeString",()=>{(0,vitest_1.it)("converts to lowercase",()=>{(0,vitest_1.expect)(normalizeString("HELLO WORLD")).toBe("hello world")}),(0,vitest_1.it)("trims whitespace",()=>{(0,vitest_1.expect)(normalizeString("  hello  ")).toBe("hello")}),(0,vitest_1.it)("handles empty string",()=>{(0,vitest_1.expect)(normalizeString("")).toBe("")}),(0,vitest_1.it)("handles mixed case with whitespace",()=>{(0,vitest_1.expect)(normalizeString("  Hello World  ")).toBe("hello world")})}),(0,vitest_1.describe)("search filtering logic",()=>{(0,vitest_1.beforeEach)(()=>{document.body.innerHTML='\n                <div class="log-entry" data-tags="tag1" data-search-content="Beautiful sunset at Tokyo DisneySea">Entry 1</div>\n                <div class="log-entry" data-tags="tag2" data-search-content="Magic Kingdom parade was amazing">Entry 2</div>\n                <div class="log-entry" data-tags="tag1,tag2" data-search-content="DisneySea Special Event">Entry 3</div>\n            '}),(0,vitest_1.it)("filters entries by partial match search",()=>{const t=document.querySelectorAll(".log-entry"),e=Array.from(t).filter(t=>{const e=t.getAttribute("data-search-content");return!!e&&e.toLowerCase().includes("disneysea")});(0,vitest_1.expect)(e.length).toBe(2)}),(0,vitest_1.it)("combines tag filter and search (AND condition)",()=>{const t=document.querySelectorAll(".log-entry"),e=["tag1"],i=Array.from(t).filter(t=>{const i=t.getAttribute("data-tags"),s=t.getAttribute("data-search-content");if(!i||!s)return!1;const n=i.split(",").map(t=>t.trim()),a=e.every(t=>n.includes(t)),r=s.toLowerCase().includes("disneysea");return a&&r});(0,vitest_1.expect)(i.length).toBe(2)}),(0,vitest_1.it)("returns all entries when search is empty",()=>{const t=document.querySelectorAll(".log-entry"),e=Array.from(t).filter(t=>{t.getAttribute("data-search-content");return!0});(0,vitest_1.expect)(e.length).toBe(3)}),(0,vitest_1.it)("returns no entries when search matches nothing",()=>{const t=document.querySelectorAll(".log-entry"),e=Array.from(t).filter(t=>{const e=t.getAttribute("data-search-content");return!!e&&e.toLowerCase().includes("nonexistent")});(0,vitest_1.expect)(e.length).toBe(0)}),(0,vitest_1.it)("handles case-insensitive search",()=>{const t=document.querySelectorAll(".log-entry"),e=Array.from(t).filter(t=>{const e=t.getAttribute("data-search-content");return!!e&&e.toLowerCase().includes("DISNEYSEA".toLowerCase())});(0,vitest_1.expect)(e.length).toBe(2)})}),(0,vitest_1.describe)("search filter toggle",()=>{(0,vitest_1.beforeEach)(()=>{document.body.innerHTML='\n                <button id="toggle-search-filter" aria-expanded="false" aria-controls="search-filter">キーワード検索</button>\n                <div class="search-filter" id="search-filter" style="display: none;">\n                    <input type="text" id="search-input" class="input" placeholder="検索..." />\n                </div>\n            '}),(0,vitest_1.it)("search filter toggle button exists",()=>{const t=document.getElementById("toggle-search-filter");(0,vitest_1.expect)(t).toBeTruthy(),(0,vitest_1.expect)(t?.getAttribute("aria-expanded")).toBe("false")}),(0,vitest_1.it)("search filter is initially hidden",()=>{const t=document.getElementById("search-filter");(0,vitest_1.expect)(t).toBeTruthy(),(0,vitest_1.expect)(t?.style.display).toBe("none")})}),(0,vitest_1.describe)("clear selection behavior",()=>{(0,vitest_1.beforeEach)(()=>{document.body.innerHTML='\n                <input type="text" id="search-input" class="input" placeholder="検索..." value="test query" />\n                <button class="tag-filter-btn active" data-tag="tag1">Tag 1</button>\n                <button class="tag-filter-btn active" data-tag="tag2">Tag 2</button>\n                <button id="clear-selection">クリア</button>\n                <div class="selected-tags"></div>\n                <div class="selected-tags-list"></div>\n            '}),(0,vitest_1.it)("search query is preserved after clear selection",()=>{const t=document.getElementById("search-input"),e="test query";t.value=e,(0,vitest_1.expect)(t.value).toBe(e)}),(0,vitest_1.it)("tag selections can be cleared independently",()=>{const t=document.querySelectorAll(".tag-filter-btn");(0,vitest_1.expect)(t.length).toBe(2),t.forEach(t=>{(0,vitest_1.expect)(t.classList.contains("active")).toBe(!0)})})}),(0,vitest_1.describe)("space-separated keyword search",()=>{(0,vitest_1.beforeEach)(()=>{document.body.innerHTML='\n                <div class="log-entry" data-tags="tag1" data-search-content="Tokyo DisneySea Magic">Entry 1</div>\n                <div class="log-entry" data-tags="tag2" data-search-content="Disney Magic Kingdom">Entry 2</div>\n                <div class="log-entry" data-tags="tag1,tag2" data-search-content="Tokyo DisneySea Special Event">Entry 3</div>\n                <div class="log-entry" data-tags="tag3" data-search-content="Universal Studios Japan">Entry 4</div>\n            '}),(0,vitest_1.it)("filters entries with single keyword",()=>{const t=document.querySelectorAll(".log-entry"),e=Array.from(t).filter(t=>{const e=t.getAttribute("data-search-content");if(!e)return!1;const i=normalizeString(e),s=normalizeString("tokyo");return i.includes(s)});(0,vitest_1.expect)(e.length).toBe(2)}),(0,vitest_1.it)("filters entries with multiple keywords (AND condition)",()=>{const t=document.querySelectorAll(".log-entry"),e=Array.from(t).filter(t=>{const e=t.getAttribute("data-search-content");if(!e)return!1;const i=normalizeString(e);return normalizeString("tokyo disneysea").split(/\s+/).filter(t=>t.length>0).every(t=>i.includes(t))});(0,vitest_1.expect)(e.length).toBe(2)}),(0,vitest_1.it)("filters entries with three or more keywords",()=>{const t=document.querySelectorAll(".log-entry"),e=Array.from(t).filter(t=>{const e=t.getAttribute("data-search-content");if(!e)return!1;const i=normalizeString(e);return normalizeString("tokyo disneysea special").split(/\s+/).filter(t=>t.length>0).every(t=>i.includes(t))});(0,vitest_1.expect)(e.length).toBe(1)}),(0,vitest_1.it)("handles case-insensitive multi-keyword search",()=>{const t=document.querySelectorAll(".log-entry"),e=Array.from(t).filter(t=>{const e=t.getAttribute("data-search-content");if(!e)return!1;const i=normalizeString(e);return normalizeString("TOKYO DisneySea").split(/\s+/).filter(t=>t.length>0).every(t=>i.includes(t))});(0,vitest_1.expect)(e.length).toBe(2)}),(0,vitest_1.it)("returns no entries when no keywords match",()=>{const t=document.querySelectorAll(".log-entry"),e=Array.from(t).filter(t=>{const e=t.getAttribute("data-search-content");if(!e)return!1;const i=normalizeString(e);return normalizeString("nonexistent keyword").split(/\s+/).filter(t=>t.length>0).every(t=>i.includes(t))});(0,vitest_1.expect)(e.length).toBe(0)})}),(0,vitest_1.describe)("integration tests",()=>{(0,vitest_1.beforeEach)(()=>{document.body.innerHTML='\n                <div id="loading-overlay"></div>\n                <div id="main-content"></div>\n                <div id="progress-bar"></div>\n                <div id="progress-text"></div>\n                <div id="loading-details"></div>\n                <input type="text" id="search-input" class="input" placeholder="検索..." />\n                <div class="log-entry" data-tags="tag1" data-search-content="Tokyo DisneySea Magic">Entry 1</div>\n                <div class="log-entry" data-tags="tag2" data-search-content="Disney Magic Kingdom">Entry 2</div>\n                <div class="log-entry" data-tags="tag1,tag2" data-search-content="Special Event">Entry 3</div>\n            '}),(0,vitest_1.it)("should filter entries when user types in search input",t=>{const e=document.getElementById("search-input"),i=document.querySelectorAll(".log-entry");(0,vitest_1.expect)(e).toBeTruthy(),(0,vitest_1.expect)(i.length).toBe(3),e.value="disney";const s=new Event("input",{bubbles:!0});e.dispatchEvent(s),setTimeout(()=>{(0,vitest_1.expect)(e.value).toBe("disney"),t()},350)}),(0,vitest_1.it)("should handle multiple rapid inputs with debounce",t=>{const e=document.getElementById("search-input");(0,vitest_1.expect)(e).toBeTruthy(),e.value="d",e.dispatchEvent(new Event("input",{bubbles:!0})),setTimeout(()=>{e.value="di",e.dispatchEvent(new Event("input",{bubbles:!0}))},50),setTimeout(()=>{e.value="dis",e.dispatchEvent(new Event("input",{bubbles:!0}))},100),setTimeout(()=>{e.value="disney",e.dispatchEvent(new Event("input",{bubbles:!0}))},150),setTimeout(()=>{(0,vitest_1.expect)(e.value).toBe("disney"),t()},500)}),(0,vitest_1.it)("should normalize search queries correctly",()=>{const t=normalizeString("DISNEY");(0,vitest_1.expect)(t).toBe("disney");const e=normalizeString("  Disney  ");(0,vitest_1.expect)(e).toBe("disney");const i=normalizeString("  TOKYO DisneySea  ");(0,vitest_1.expect)(i).toBe("tokyo disneysea")}),(0,vitest_1.it)("should handle empty search input",t=>{const e=document.getElementById("search-input");(0,vitest_1.expect)(e).toBeTruthy(),e.value="";const i=new Event("input",{bubbles:!0});e.dispatchEvent(i),setTimeout(()=>{(0,vitest_1.expect)(e.value).toBe(""),t()},350)}),(0,vitest_1.it)("should verify search input element exists",()=>{const t=document.getElementById("search-input");(0,vitest_1.expect)(t).toBeTruthy(),(0,vitest_1.expect)(t?.getAttribute("placeholder")).toBe("検索...")}),(0,vitest_1.it)("should add active class to tag button when clicked",()=>{document.body.innerHTML='\n                <button class="tag-filter-btn is-outlined" data-tag="tag1">Tag 1</button>\n                <button class="tag-filter-btn is-outlined" data-tag="tag2">Tag 2</button>\n            ';const t=document.querySelector('[data-tag="tag1"]');(0,vitest_1.expect)(t).toBeTruthy(),(0,vitest_1.expect)(t?.classList.contains("is-outlined")).toBe(!0),(0,vitest_1.expect)(t?.classList.contains("active")).toBe(!1),t?.classList.add("active"),t?.classList.remove("is-outlined"),(0,vitest_1.expect)(t?.classList.contains("active")).toBe(!0),(0,vitest_1.expect)(t?.classList.contains("is-outlined")).toBe(!1)}),(0,vitest_1.it)("should remove active class from all tag buttons after clear button click",()=>{document.body.innerHTML='\n                <button class="tag-filter-btn active" data-tag="tag1">Tag 1</button>\n                <button class="tag-filter-btn active" data-tag="tag2">Tag 2</button>\n                <button id="clear-selection">Clear</button>\n            ';const t=document.querySelectorAll(".tag-filter-btn");(0,vitest_1.expect)(t.length).toBe(2),t.forEach(t=>{(0,vitest_1.expect)(t.classList.contains("active")).toBe(!0)}),t.forEach(t=>{t.classList.remove("active"),t.classList.add("is-outlined")}),t.forEach(t=>{(0,vitest_1.expect)(t.classList.contains("active")).toBe(!1),(0,vitest_1.expect)(t.classList.contains("is-outlined")).toBe(!0)})}),(0,vitest_1.it)("should toggle search filter visibility correctly",()=>{document.body.innerHTML='\n                <button id="toggle-search-filter" class="is-outlined" aria-expanded="false">Toggle Search</button>\n                <div id="search-filter" style="display: none;">Search Filter Content</div>\n            ';const t=document.getElementById("toggle-search-filter"),e=document.getElementById("search-filter");(0,vitest_1.expect)(t).toBeTruthy(),(0,vitest_1.expect)(e).toBeTruthy(),(0,vitest_1.expect)(e?.style.display).toBe("none"),(0,vitest_1.expect)(t?.classList.contains("is-outlined")).toBe(!0),e&&(e.style.display="block"),t?.classList.remove("is-outlined"),t?.classList.add("is-info"),t?.setAttribute("aria-expanded","true"),(0,vitest_1.expect)(e?.style.display).toBe("block"),(0,vitest_1.expect)(t?.classList.contains("is-info")).toBe(!0),(0,vitest_1.expect)(t?.getAttribute("aria-expanded")).toBe("true"),e&&(e.style.display="none"),t?.classList.remove("is-info"),t?.classList.add("is-outlined"),t?.setAttribute("aria-expanded","false"),(0,vitest_1.expect)(e?.style.display).toBe("none"),(0,vitest_1.expect)(t?.classList.contains("is-outlined")).toBe(!0),(0,vitest_1.expect)(t?.getAttribute("aria-expanded")).toBe("false")})})});
