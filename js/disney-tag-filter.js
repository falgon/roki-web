"use strict";const escapeHtml=e=>{const t=document.createElement("div");return t.textContent=e,t.innerHTML},normalizeString=e=>e.toLowerCase().trim(),initLoadingScreen=()=>{const e=document.getElementById("loading-overlay"),t=document.getElementById("main-content"),n=document.getElementById("progress-bar"),o=document.getElementById("progress-text"),r=document.getElementById("loading-details");if(!(e&&t&&n&&o&&r))return;const a=!0===window.isPreview,s=e=>{a&&console.log(e)};let i=0;const l=setInterval(()=>{i+=2*Math.random(),i>85&&(i=85),n.style.width=`${i}%`,o.textContent=`${Math.floor(i)}%`},50);(async()=>{s("Starting resource loading detection...");const e=[];s("Waiting for fonts to load..."),e.push(document.fonts.ready.then(()=>{s("Fonts loaded"),i=90,n.style.width="90%",o.textContent="90%",r.textContent="Loading images..."}));const t=document.querySelectorAll("img");if(s(`Found ${t.length} images to load`),0===t.length)e.push(Promise.resolve().then(()=>{i=95,n.style.width="95%",o.textContent="95%",r.textContent="Loading stylesheets..."}));else{const a=Array.from(t).map((e,n)=>new Promise(o=>{if(s(`Image ${n+1}/${t.length}: ${e.src}, complete: ${e.complete}, naturalHeight: ${e.naturalHeight}`),e.complete&&0!==e.naturalHeight)return s(`Image ${n+1} already loaded`),void o();const r=()=>{s(`Image ${n+1} loaded successfully`),e.removeEventListener("load",r),e.removeEventListener("error",a),o()},a=()=>{s(`Image ${n+1} failed to load`),e.removeEventListener("load",r),e.removeEventListener("error",a),o()};e.addEventListener("load",r),e.addEventListener("error",a),e.complete&&setTimeout(()=>{e.complete&&0!==e.naturalHeight||(s(`Image ${n+1} fallback: treating as loaded`),o())},100)}));e.push(Promise.all(a).then(()=>{s("All images loaded"),i=95,n.style.width="95%",o.textContent="95%",r.textContent="Loading stylesheets..."}))}const a=document.querySelectorAll('link[rel="stylesheet"]');if(s(`Found ${a.length} stylesheets to load`),0===a.length)e.push(Promise.resolve().then(()=>{i=97,n.style.width="97%",o.textContent="97%",r.textContent="Loading JavaScript..."}));else{const t=Array.from(a).map((e,t)=>new Promise(n=>{if(s(`Stylesheet ${t+1}/${a.length}: ${e.href}, sheet: ${!!e.sheet}`),e.sheet)return s(`Stylesheet ${t+1} already loaded`),void n();const o=()=>{s(`Stylesheet ${t+1} loaded successfully`),e.removeEventListener("load",o),e.removeEventListener("error",r),n()},r=()=>{s(`Stylesheet ${t+1} failed to load`),e.removeEventListener("load",o),e.removeEventListener("error",r),n()};e.addEventListener("load",o),e.addEventListener("error",r),e.sheet&&setTimeout(()=>{e.sheet||(s(`Stylesheet ${t+1} fallback: treating as loaded`),n())},100)}));e.push(Promise.all(t).then(()=>{s("All stylesheets loaded"),i=97,n.style.width="97%",o.textContent="97%",r.textContent="Loading JavaScript..."}))}const l=document.querySelectorAll("script[src]");if(s(`Found ${l.length} scripts to load`),0===l.length)e.push(Promise.resolve().then(()=>{i=98,n.style.width="98%",o.textContent="98%",r.textContent="Initializing page..."}));else{const t=Array.from(l).map((e,t)=>new Promise(n=>{const o=e.readyState,r=e.async,a=e.defer;s(`Script ${t+1}/${l.length}: ${e.src}`),s(`  - readyState: ${o}`),s(`  - async: ${r}`),s(`  - defer: ${a}`);let i=!1;const d=()=>{i||(i=!0,s(`Script ${t+1} loaded successfully`),e.removeEventListener("load",d),e.removeEventListener("error",c),n())},c=()=>{i||(i=!0,s(`Script ${t+1} failed to load`),e.removeEventListener("load",d),e.removeEventListener("error",c),n())};e.addEventListener("load",d),e.addEventListener("error",c);if(!(()=>{const n=e.src;if("complete"===o||"loaded"===o)return s(`Script ${t+1} already loaded (readyState: ${o})`),!0;if(Array.from(document.scripts).filter(t=>t.src===n&&t!==e).length>0)return s(`Script ${t+1} appears to be already loaded (duplicate found)`),!0;try{const n=e.readyState;if("complete"===n||"loaded"===n)return s(`Script ${t+1} already loaded (execution ready)`),!0}catch(e){}const r=performance.now()-(performance.timing?.navigationStart||0);return r>1e3&&(s(`Script ${t+1} likely already loaded (page load time: ${r.toFixed(0)}ms)`),!0)})())return void 0===o?(s(`Script ${t+1} readyState is undefined, checking if already loaded...`),r?(s(`Script ${t+1} is async, using short timeout`),void setTimeout(()=>{i||(s(`Script ${t+1} async script timeout`),i=!0,e.removeEventListener("load",d),e.removeEventListener("error",c),n())},1e3)):(s(`Script ${t+1} readyState undefined and not async, likely already loaded`),void setTimeout(()=>{i||(s(`Script ${t+1} treating as already loaded`),i=!0,e.removeEventListener("load",d),e.removeEventListener("error",c),n())},500))):void setTimeout(()=>{i||(s(`Script ${t+1} fallback: treating as loaded after timeout`),i=!0,e.removeEventListener("load",d),e.removeEventListener("error",c),n())},1e3);setTimeout(()=>{i||(i=!0,e.removeEventListener("load",d),e.removeEventListener("error",c),n())},100)}));e.push(Promise.all(t).then(()=>{s("All scripts loaded"),i=98,n.style.width="98%",o.textContent="98%",r.textContent="Initializing page..."}))}s("Waiting for DOMContentLoaded..."),e.push(new Promise(e=>{"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{s("DOMContentLoaded fired"),e()}):(s("DOMContentLoaded already fired"),e())})),s("Waiting for load event..."),e.push(new Promise(e=>{"complete"===document.readyState?(s("Load event already fired"),e()):window.addEventListener("load",()=>{s("Load event fired"),e()})})),s("Waiting for all resources to be ready..."),e.push(new Promise(e=>{const t=()=>{s(`Current document.readyState: ${document.readyState}`),"complete"===document.readyState?(s("Document is completely loaded"),e()):setTimeout(t,50)};t()})),s("Waiting for all resources to complete..."),await Promise.all(e),s("All resources loaded successfully")})().then(()=>{s("Starting final loading completion..."),clearInterval(l),i=100,n.style.width="100%",o.textContent="100%",r.textContent="Done!",setTimeout(()=>{s("Hiding loading overlay..."),e.classList.add("hidden"),t.classList.add("loaded"),setTimeout(()=>{s("Removing loading overlay..."),e.remove(),s("Loading process completed successfully!")},500)},500)}).catch(d=>{a&&console.error("Error during resource loading:",d),clearInterval(l),i=100,n.style.width="100%",o.textContent="100%",r.textContent="Done!",setTimeout(()=>{e.classList.add("hidden"),t.classList.add("loaded"),setTimeout(()=>{e.remove(),s("Loading process completed with errors")},500)},500)}),setTimeout(()=>{t.classList.contains("loaded")||(clearInterval(l),i=100,n.style.width="100%",o.textContent="100%",setTimeout(()=>{e.classList.add("hidden"),t.classList.add("loaded"),setTimeout(()=>{e.remove()},500)},500))},15e3)},initializeLogImageSlideshows=()=>{const e=Array.from(document.querySelectorAll(".log-images[data-image-slideshow]"));if(0===e.length)return;const t=document.getElementById("log-image-modal"),n=document.getElementById("log-image-modal-img"),o=t?.querySelector(".log-image-modal-close")??null,r=t?.querySelector(".log-image-modal-nav.prev")??null,a=t?.querySelector(".log-image-modal-nav.next")??null,s=[];let i=null,l=0;const d=e=>{e.forEach(e=>{(e=>{if(!e)return;const t=e.dataset.src;t&&e.getAttribute("src")!==t&&e.setAttribute("src",t)})(e.querySelector("img"))})},c=(e,t)=>{if("function"!=typeof window.IntersectionObserver)return void d(t);new IntersectionObserver((n,o)=>{n.some(e=>e.isIntersecting)&&(d(t),o.unobserve(e),o.disconnect())},{root:null,rootMargin:"200px 0px",threshold:.1}).observe(e)},u=()=>t?.classList.contains("is-active")??!1,m=()=>{if(!n||!i)return;const e=i.slides[l],t=e?.querySelector("img"),o=e?.dataset.imageUrl||t?.dataset.src||t?.getAttribute("src")||"",r=e?.dataset.imageAlt||t?.getAttribute("alt")||"体験録画像";n.src=o,n.alt=r},y=(e,o)=>{t&&n&&(i=e,l=o,e.stopAutoplay(),m(),t.classList.add("is-active"),t.setAttribute("aria-hidden","false"),document.body.style.overflow="hidden")},g=()=>{t&&(t.classList.remove("is-active"),t.setAttribute("aria-hidden","true"),document.body.style.overflow="",i&&i.startAutoplay(),i=null)},p=e=>{if(!i)return;const t=i.slides.length;0!==t&&(l=(l+e+t)%t,i.goTo(l),m())};for(const t of e){const e=Array.from(t.querySelectorAll(".log-image-slide"));if(0===e.length)continue;const n=Array.from(t.querySelectorAll(".slideshow-dot")),o=t.querySelector(".slideshow-control.prev"),r=t.querySelector(".slideshow-control.next"),a=t.querySelector(".slideshow-dots"),i={slides:e,dots:n,currentIndex:0,autoplayTimer:null,goTo:e=>{const t=i.slides.length;0!==t&&(i.currentIndex=(e+t)%t,i.slides.forEach((e,t)=>{const n=t===i.currentIndex;e.classList.toggle("is-active",n),e.setAttribute("aria-hidden",String(!n)),e.tabIndex=n?0:-1}),i.dots.forEach((e,t)=>{const n=t===i.currentIndex;e.classList.toggle("is-active",n),e.setAttribute("aria-selected",String(n)),e.tabIndex=n?0:-1}))},startAutoplay:()=>{i.stopAutoplay(),i.slides.length<=1||u()||(i.autoplayTimer=setInterval(()=>{i.goTo(i.currentIndex+1)},4e3))},stopAutoplay:()=>{i.autoplayTimer&&(clearInterval(i.autoplayTimer),i.autoplayTimer=null)}};c(t,e),i.slides.length<=1?(o&&(o.style.display="none"),r&&(r.style.display="none"),a&&(a.style.display="none")):(o&&o.addEventListener("click",e=>{e.preventDefault(),i.goTo(i.currentIndex-1),i.startAutoplay()}),r&&r.addEventListener("click",e=>{e.preventDefault(),i.goTo(i.currentIndex+1),i.startAutoplay()}),i.dots.forEach((e,t)=>{e.addEventListener("click",e=>{e.preventDefault(),i.goTo(t),i.startAutoplay()})}),t.addEventListener("mouseenter",()=>{i.stopAutoplay()}),t.addEventListener("mouseleave",()=>{i.startAutoplay()}),t.addEventListener("focusin",()=>{i.stopAutoplay()}),t.addEventListener("focusout",e=>{const n=e.relatedTarget;n&&t.contains(n)||i.startAutoplay()})),i.slides.forEach((e,t)=>{e.addEventListener("click",e=>{e.preventDefault(),y(i,t)})}),i.goTo(0),i.startAutoplay(),s.push(i)}t&&n&&(o?.addEventListener("click",()=>{g()}),t.addEventListener("click",e=>{e.target===t&&g()}),r?.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),p(-1)}),a?.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),p(1)}),document.addEventListener("keydown",e=>{u()&&("Escape"===e.key?g():"ArrowLeft"===e.key?p(-1):"ArrowRight"===e.key&&p(1))}),document.addEventListener("visibilitychange",()=>{document.hidden?s.forEach(e=>{e.stopAutoplay()}):u()||s.forEach(e=>{e.startAutoplay()})}))},initializeSearchFilter=(e,t)=>{e.addEventListener("click",()=>{"none"!==t.style.display?(t.style.display="none",e.setAttribute("aria-expanded","false")):(t.style.display="block",e.setAttribute("aria-expanded","true"))})},initializeTagFilter=(e,t)=>{e.addEventListener("click",()=>{"none"!==t.style.display?(t.style.display="none",e.setAttribute("aria-expanded","false")):(t.style.display="block",e.setAttribute("aria-expanded","true"))})},initializeTagButtons=(e,t,n,o)=>{for(const r of Array.from(e))r.addEventListener("click",function(){const e=this.getAttribute("data-tag");e&&(this.classList.contains("active")?(this.classList.remove("active"),this.classList.add("is-outlined"),t.delete(e)):(this.classList.add("active"),this.classList.remove("is-outlined"),t.add(e)),n(),o())})},initializeClearButton=(e,t,n)=>{e.addEventListener("click",()=>{t(),n()})},initializeSearchInput=(e,t,n)=>{let o=null;e.addEventListener("input",e=>{const r=e.target;t.value=r.value,o&&clearTimeout(o),o=setTimeout(()=>{n(),o=null},300)})};"undefined"!=typeof window&&(window.escapeHtml=escapeHtml,window.normalizeString=normalizeString,window.initLoadingScreen=initLoadingScreen,window.initializeLogImageSlideshows=initializeLogImageSlideshows),"undefined"!=typeof document&&document.addEventListener("DOMContentLoaded",()=>{initLoadingScreen(),initializeLogImageSlideshows();const e=document.getElementsByClassName("tag-filter-btn"),t=document.getElementsByClassName("log-entry"),n=document.getElementsByClassName("selected-tags")[0],o=document.getElementsByClassName("selected-tags-list")[0],r=document.getElementById("clear-selection"),a=document.getElementById("toggle-tag-filter"),s=document.getElementsByClassName("tag-filter")[0],i=document.getElementById("toggle-search-filter"),l=document.getElementById("search-filter"),d=document.getElementById("search-input"),c=new Set,u={value:""},m=()=>{c.clear();for(const t of Array.from(e))t.classList.remove("active"),t.classList.add("is-outlined");y()},y=()=>{if(n&&o)if(0===c.size)n.style.display="none";else{n.style.display="block";const e=Array.from(c).map(e=>{const t=document.querySelector(`[data-tag="${escapeHtml(e)}"]`),n=t?.style.borderColor||t?.style.color||"#363636";return`<span class="tag is-small" style="background-color: ${escapeHtml(n)}; color: white; margin-right: 0.5rem;">${escapeHtml(e)}</span>`}).join("");o.innerHTML=e}},g=()=>{const e=normalizeString(u.value);for(const n of Array.from(t)){const t=n;let o=!0;if(c.size>0){const e=n.getAttribute("data-tags");if(e){const t=e.split(",").map(e=>e.trim());o=Array.from(c).every(e=>t.includes(e))}else o=!1}let r=!0;if(""!==e){const t=n.getAttribute("data-search-content");if(t){const n=normalizeString(t);r=e.split(/\s+/).filter(e=>e.length>0).every(e=>n.includes(e))}else r=!1}o&&r?(t.style.display="block",n.classList.remove("filtered-out")):(t.style.display="none",n.classList.add("filtered-out"))}p()},p=()=>{Array.from(t).filter(e=>!e.classList.contains("filtered-out")).forEach((e,t)=>{const n=e;n.style.opacity="0",n.style.transform="translateY(20px)",requestAnimationFrame(()=>{setTimeout(()=>{n.style.transition="opacity 0.3s ease, transform 0.3s ease",n.style.opacity="1",n.style.transform="translateY(0)"},50*t)})})};i&&l&&initializeSearchFilter(i,l),a&&s&&initializeTagFilter(a,s),initializeTagButtons(e,c,y,g),r&&initializeClearButton(r,m,g),d?initializeSearchInput(d,u,g):!0===window.isPreview&&console.warn("Search input element not found")});
