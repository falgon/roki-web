"use strict";const escapeHtml=e=>{const t=document.createElement("div");return t.textContent=e,t.innerHTML},normalizeString=e=>e.toLowerCase().trim(),initLoadingScreen=()=>{const e=document.getElementById("loading-overlay"),t=document.getElementById("main-content"),a=document.getElementById("progress-bar"),s=document.getElementById("progress-text"),n=document.getElementById("loading-details");if(!(e&&t&&a&&s&&n))return;const i=!0===window.isPreview,o=e=>{i&&console.log(e)};let r=0;const l=setInterval(()=>{r+=2*Math.random(),r>85&&(r=85),a.style.width=`${r}%`,s.textContent=`${Math.floor(r)}%`},50);(async()=>{o("Starting resource loading detection...");const e=[];o("Waiting for fonts to load..."),e.push(document.fonts.ready.then(()=>{o("Fonts loaded"),r=90,a.style.width="90%",s.textContent="90%",n.textContent="Loading images..."}));const t=Array.from(document.querySelectorAll("img")).filter(e=>!("string"==typeof e.dataset.src&&normalizeString(e.dataset.src).length>0&&null!==e.closest(".log-images[data-image-slideshow]")));if(o(`Found ${t.length} images to load (excluding deferred slideshow images)`),0===t.length)e.push(Promise.resolve().then(()=>{r=95,a.style.width="95%",s.textContent="95%",n.textContent="Loading stylesheets..."}));else{const i=Array.from(t).map((e,a)=>new Promise(s=>{if(o(`Image ${a+1}/${t.length}: ${e.src}, complete: ${e.complete}, naturalHeight: ${e.naturalHeight}`),e.complete&&0!==e.naturalHeight)return o(`Image ${a+1} already loaded`),void s();const n=()=>{o(`Image ${a+1} loaded successfully`),e.removeEventListener("load",n),e.removeEventListener("error",i),s()},i=()=>{o(`Image ${a+1} failed to load`),e.removeEventListener("load",n),e.removeEventListener("error",i),s()};e.addEventListener("load",n),e.addEventListener("error",i),e.complete&&setTimeout(()=>{e.complete&&0!==e.naturalHeight||(o(`Image ${a+1} fallback: treating as loaded`),s())},100)}));e.push(Promise.all(i).then(()=>{o("All images loaded"),r=95,a.style.width="95%",s.textContent="95%",n.textContent="Loading stylesheets..."}))}const i=document.querySelectorAll('link[rel="stylesheet"]');if(o(`Found ${i.length} stylesheets to load`),0===i.length)e.push(Promise.resolve().then(()=>{r=97,a.style.width="97%",s.textContent="97%",n.textContent="Loading JavaScript..."}));else{const t=Array.from(i).map((e,t)=>new Promise(a=>{if(o(`Stylesheet ${t+1}/${i.length}: ${e.href}, sheet: ${!!e.sheet}`),e.sheet)return o(`Stylesheet ${t+1} already loaded`),void a();const s=()=>{o(`Stylesheet ${t+1} loaded successfully`),e.removeEventListener("load",s),e.removeEventListener("error",n),a()},n=()=>{o(`Stylesheet ${t+1} failed to load`),e.removeEventListener("load",s),e.removeEventListener("error",n),a()};e.addEventListener("load",s),e.addEventListener("error",n),e.sheet&&setTimeout(()=>{e.sheet||(o(`Stylesheet ${t+1} fallback: treating as loaded`),a())},100)}));e.push(Promise.all(t).then(()=>{o("All stylesheets loaded"),r=97,a.style.width="97%",s.textContent="97%",n.textContent="Loading JavaScript..."}))}const l=document.querySelectorAll("script[src]");if(o(`Found ${l.length} scripts to load`),0===l.length)e.push(Promise.resolve().then(()=>{r=98,a.style.width="98%",s.textContent="98%",n.textContent="Initializing page..."}));else{const t=Array.from(l).map((e,t)=>new Promise(a=>{const s=e.readyState,n=e.async,i=e.defer;o(`Script ${t+1}/${l.length}: ${e.src}`),o(`  - readyState: ${s}`),o(`  - async: ${n}`),o(`  - defer: ${i}`);let r=!1;const d=()=>{r||(r=!0,o(`Script ${t+1} loaded successfully`),e.removeEventListener("load",d),e.removeEventListener("error",c),a())},c=()=>{r||(r=!0,o(`Script ${t+1} failed to load`),e.removeEventListener("load",d),e.removeEventListener("error",c),a())};e.addEventListener("load",d),e.addEventListener("error",c);if(!(()=>{const a=e.src;if("complete"===s||"loaded"===s)return o(`Script ${t+1} already loaded (readyState: ${s})`),!0;if(Array.from(document.scripts).filter(t=>t.src===a&&t!==e).length>0)return o(`Script ${t+1} appears to be already loaded (duplicate found)`),!0;try{const a=e.readyState;if("complete"===a||"loaded"===a)return o(`Script ${t+1} already loaded (execution ready)`),!0}catch(e){}const n=performance.now()-(performance.timing?.navigationStart||0);return n>1e3&&(o(`Script ${t+1} likely already loaded (page load time: ${n.toFixed(0)}ms)`),!0)})())return void 0===s?(o(`Script ${t+1} readyState is undefined, checking if already loaded...`),n?(o(`Script ${t+1} is async, using short timeout`),void setTimeout(()=>{r||(o(`Script ${t+1} async script timeout`),r=!0,e.removeEventListener("load",d),e.removeEventListener("error",c),a())},1e3)):(o(`Script ${t+1} readyState undefined and not async, likely already loaded`),void setTimeout(()=>{r||(o(`Script ${t+1} treating as already loaded`),r=!0,e.removeEventListener("load",d),e.removeEventListener("error",c),a())},500))):void setTimeout(()=>{r||(o(`Script ${t+1} fallback: treating as loaded after timeout`),r=!0,e.removeEventListener("load",d),e.removeEventListener("error",c),a())},1e3);setTimeout(()=>{r||(r=!0,e.removeEventListener("load",d),e.removeEventListener("error",c),a())},100)}));e.push(Promise.all(t).then(()=>{o("All scripts loaded"),r=98,a.style.width="98%",s.textContent="98%",n.textContent="Initializing page..."}))}o("Waiting for DOMContentLoaded..."),e.push(new Promise(e=>{"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{o("DOMContentLoaded fired"),e()}):(o("DOMContentLoaded already fired"),e())})),o("Waiting for load event..."),e.push(new Promise(e=>{"complete"===document.readyState?(o("Load event already fired"),e()):window.addEventListener("load",()=>{o("Load event fired"),e()})})),o("Waiting for all resources to be ready..."),e.push(new Promise(e=>{const t=()=>{o(`Current document.readyState: ${document.readyState}`),"complete"===document.readyState?(o("Document is completely loaded"),e()):setTimeout(t,50)};t()})),o("Waiting for all resources to complete..."),await Promise.all(e),o("All resources loaded successfully")})().then(()=>{o("Starting final loading completion..."),clearInterval(l),r=100,a.style.width="100%",s.textContent="100%",n.textContent="Done!",setTimeout(()=>{o("Hiding loading overlay..."),e.classList.add("hidden"),t.classList.add("loaded"),setTimeout(()=>{o("Removing loading overlay..."),e.remove(),o("Loading process completed successfully!")},500)},500)}).catch(d=>{i&&console.error("Error during resource loading:",d),clearInterval(l),r=100,a.style.width="100%",s.textContent="100%",n.textContent="Done!",setTimeout(()=>{e.classList.add("hidden"),t.classList.add("loaded"),setTimeout(()=>{e.remove(),o("Loading process completed with errors")},500)},500)}),setTimeout(()=>{t.classList.contains("loaded")||(clearInterval(l),r=100,a.style.width="100%",s.textContent="100%",setTimeout(()=>{e.classList.add("hidden"),t.classList.add("loaded"),setTimeout(()=>{e.remove()},500)},500))},15e3)},initializeLogImageSlideshows=()=>{const e="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",t=Array.from(document.querySelectorAll(".log-images[data-image-slideshow]"));if(0===t.length)return;const a=document.getElementById("log-image-modal"),s=document.getElementById("log-image-modal-img"),n=a?.querySelector(".log-image-modal-close")??null,i=a?.querySelector(".log-image-modal-nav.prev")??null,o=a?.querySelector(".log-image-modal-nav.next")??null,r=[];let l=null,d=0;const c=e=>{e.preventDefault(),e.stopPropagation()},u=t=>{t.forEach(t=>{((t,a)=>{if(!a)return;const s=a.dataset.src;s&&a.getAttribute("src")!==s&&(t.dataset.imageLoaded="false",t.classList.remove("is-image-loaded"),a.setAttribute("src",s),a.complete&&(a.naturalWidth>0?(t.dataset.imageLoaded="true",t.classList.add("is-image-loaded")):(t.dataset.imageLoadFailed="true",t.classList.remove("is-image-loaded"),a.setAttribute("src",e),a.removeAttribute("data-src"),a.alt="")))})(t,t.querySelector("img"))})},m=(e,t,a)=>{if("function"!=typeof window.IntersectionObserver)return u(t),void a();new IntersectionObserver((s,n)=>{s.some(e=>e.isIntersecting)&&(u(t),a(),n.unobserve(e),n.disconnect())},{root:null,rootMargin:"200px 0px",threshold:.1}).observe(e)},g=()=>a?.classList.contains("is-active")??!1,y=()=>{if(!s||!l)return;const e=l.slides[d],t=e?.querySelector("img"),a=e?.dataset.imageUrl||t?.dataset.src||t?.getAttribute("src")||"",n=e?.dataset.imageAlt||t?.getAttribute("alt")||"体験録画像";s.src=a,s.alt=n},v=(e,t)=>{a&&s&&(l=e,d=t,e.stopAutoplay(),y(),a.classList.add("is-active"),a.setAttribute("aria-hidden","false"),document.body.style.overflow="hidden")},p=()=>{a&&(a.classList.remove("is-active"),a.setAttribute("aria-hidden","true"),document.body.style.overflow="",l&&l.startAutoplay(),l=null)},f=e=>{if(!l)return;const t=l.slides.length;0!==t&&(d=(d+e+t)%t,l.goTo(d),y())};for(const a of t){const t=Array.from(a.querySelectorAll(".log-image-slide"));if(0===t.length)continue;const s=Array.from(a.querySelectorAll(".slideshow-dot")),n=a.querySelector(".slideshow-control.prev"),i=a.querySelector(".slideshow-control.next"),o=a.querySelector(".slideshow-dots"),l=a.querySelector(".log-image-viewport");l?.classList.add("is-loading");const d=e=>"true"!==e.dataset.imageLoadFailed,u=e=>{const a=t.length;if(0===a)return null;const s=(e%a+a)%a;for(let e=0;e<a;e+=1){const n=(s+e)%a;if(d(t[n]))return n}return null},y=()=>t.filter(e=>d(e)).length,p=e=>"true"===e.dataset.imageLoaded,f={slides:t,dots:s,currentIndex:0,autoplayTimer:null,goTo:e=>{if(0===f.slides.length)return;const t=u(e);if(null===t)return f.currentIndex=0,f.slides.forEach(e=>{e.classList.remove("is-active"),e.setAttribute("aria-hidden","true"),e.tabIndex=-1}),f.dots.forEach(e=>{e.classList.remove("is-active"),e.setAttribute("aria-selected","false"),e.hidden=!0,e.tabIndex=-1}),n&&(n.style.display="none"),i&&(i.style.display="none"),o&&(o.style.display="none"),void h();f.currentIndex=t,f.slides.forEach((e,t)=>{const a=t===f.currentIndex;e.classList.toggle("is-active",a),e.setAttribute("aria-hidden",String(!a)),e.tabIndex=a?0:-1}),f.dots.forEach((e,t)=>{const a=t===f.currentIndex,s=d(f.slides[t]);e.classList.toggle("is-active",a),e.setAttribute("aria-selected",String(a)),e.hidden=!s,e.tabIndex=a&&s?0:-1});const a=y();n&&(n.style.display=a<=1?"none":""),i&&(i.style.display=a<=1?"none":""),o&&(o.style.display=a<=1?"none":""),h()},startAutoplay:()=>{f.stopAutoplay(),y()<=1||g()||(f.autoplayTimer=setInterval(()=>{f.goTo(f.currentIndex+1)},4e3))},stopAutoplay:()=>{f.autoplayTimer&&(clearInterval(f.autoplayTimer),f.autoplayTimer=null)}},h=()=>{if(!l)return;const e=f.slides[f.currentIndex],t=f.slides.some(e=>"true"!==e.dataset.imageLoadFailed&&"true"!==e.dataset.imageLoaded),a=!!e&&p(e);l.classList.toggle("is-loading",t&&!a)};f.slides.forEach((t,a)=>{const s=t.querySelector("img");if(!s)return;s.addEventListener("load",()=>{if("true"===t.dataset.imageLoadFailed)return;(s.getAttribute("src")??"")!==e&&(t.dataset.imageLoaded="true",t.classList.add("is-image-loaded"),f.currentIndex===a&&l?.classList.remove("is-loading"),h())}),s.addEventListener("error",()=>{"true"!==t.dataset.imageLoadFailed&&(t.dataset.imageLoadFailed="true",t.dataset.imageLoaded="false",t.classList.add("is-image-load-failed"),t.classList.remove("is-image-loaded"),s.setAttribute("src",e),s.removeAttribute("data-src"),s.alt="",f.currentIndex===a?f.goTo(a+1):f.goTo(f.currentIndex),h())});const n=s.getAttribute("src")??"";n&&n!==e&&s.complete&&s.naturalWidth>0&&(t.dataset.imageLoaded="true",t.classList.add("is-image-loaded"))}),m(a,t,h),f.slides.length<=1?(n&&(n.style.display="none"),i&&(i.style.display="none"),o&&(o.style.display="none")):(n&&(n.addEventListener("click",e=>{e.preventDefault(),f.goTo(f.currentIndex-1),f.startAutoplay()}),n.addEventListener("dblclick",c)),i&&(i.addEventListener("click",e=>{e.preventDefault(),f.goTo(f.currentIndex+1),f.startAutoplay()}),i.addEventListener("dblclick",c)),f.dots.forEach((e,t)=>{e.addEventListener("click",e=>{e.preventDefault(),f.goTo(t),f.startAutoplay()}),e.addEventListener("dblclick",c)}),a.addEventListener("mouseenter",()=>{f.stopAutoplay()}),a.addEventListener("mouseleave",()=>{f.startAutoplay()}),a.addEventListener("focusin",()=>{f.stopAutoplay()}),a.addEventListener("focusout",e=>{const t=e.relatedTarget;t&&a.contains(t)||f.startAutoplay()})),f.slides.forEach((e,t)=>{e.addEventListener("click",e=>{e.preventDefault(),v(f,t)}),e.addEventListener("dblclick",c)}),f.goTo(0),l?.classList.add("is-ready"),h(),f.startAutoplay(),r.push(f)}a&&s&&(n?.addEventListener("click",()=>{p()}),n?.addEventListener("dblclick",c),a.addEventListener("click",e=>{e.target===a&&p()}),i?.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),f(-1)}),i?.addEventListener("dblclick",c),o?.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),f(1)}),o?.addEventListener("dblclick",c),s.addEventListener("dblclick",c),document.addEventListener("keydown",e=>{g()&&("Escape"===e.key?p():"ArrowLeft"===e.key?f(-1):"ArrowRight"===e.key&&f(1))}),document.addEventListener("visibilitychange",()=>{document.hidden?r.forEach(e=>{e.stopAutoplay()}):g()||r.forEach(e=>{e.startAutoplay()})}))},initializeSearchFilter=(e,t)=>{e.addEventListener("click",()=>{"none"!==t.style.display?(t.style.display="none",e.setAttribute("aria-expanded","false")):(t.style.display="block",e.setAttribute("aria-expanded","true"))})},initializeTagFilter=(e,t)=>{e.addEventListener("click",()=>{"none"!==t.style.display?(t.style.display="none",e.setAttribute("aria-expanded","false")):(t.style.display="block",e.setAttribute("aria-expanded","true"))})},initializeTagButtons=(e,t,a,s)=>{for(const n of Array.from(e))n.addEventListener("click",function(){const e=this.getAttribute("data-tag");e&&(this.classList.contains("active")?(this.classList.remove("active"),this.classList.add("is-outlined"),t.delete(e)):(this.classList.add("active"),this.classList.remove("is-outlined"),t.add(e)),a(),s())})},initializeClearButton=(e,t,a)=>{e.addEventListener("click",()=>{t(),a()})},initializeSearchInput=(e,t,a)=>{let s=null;e.addEventListener("input",e=>{const n=e.target;t.value=n.value,s&&clearTimeout(s),s=setTimeout(()=>{a(),s=null},300)})};"undefined"!=typeof window&&(window.escapeHtml=escapeHtml,window.normalizeString=normalizeString,window.initLoadingScreen=initLoadingScreen,window.initializeLogImageSlideshows=initializeLogImageSlideshows),"undefined"!=typeof document&&document.addEventListener("DOMContentLoaded",()=>{initLoadingScreen(),initializeLogImageSlideshows();const e=document.getElementsByClassName("tag-filter-btn"),t=document.getElementsByClassName("log-entry"),a=document.getElementsByClassName("selected-tags")[0],s=document.getElementsByClassName("selected-tags-list")[0],n=document.getElementById("clear-selection"),i=document.getElementById("toggle-tag-filter"),o=document.getElementsByClassName("tag-filter")[0],r=document.getElementById("toggle-search-filter"),l=document.getElementById("search-filter"),d=document.getElementById("search-input"),c=new Set,u={value:""},m=()=>{c.clear();for(const t of Array.from(e))t.classList.remove("active"),t.classList.add("is-outlined");g()},g=()=>{if(a&&s)if(0===c.size)a.style.display="none";else{a.style.display="block";const e=Array.from(c).map(e=>{const t=document.querySelector(`[data-tag="${escapeHtml(e)}"]`),a=t?.style.borderColor||t?.style.color||"#363636";return`<span class="tag is-small" style="background-color: ${escapeHtml(a)}; color: white; margin-right: 0.5rem;">${escapeHtml(e)}</span>`}).join("");s.innerHTML=e}},y=()=>{const e=normalizeString(u.value);for(const a of Array.from(t)){const t=a;let s=!0;if(c.size>0){const e=a.getAttribute("data-tags");if(e){const t=e.split(",").map(e=>e.trim());s=Array.from(c).every(e=>t.includes(e))}else s=!1}let n=!0;if(""!==e){const t=a.getAttribute("data-search-content");if(t){const a=normalizeString(t);n=e.split(/\s+/).filter(e=>e.length>0).every(e=>a.includes(e))}else n=!1}s&&n?(t.style.display="block",a.classList.remove("filtered-out")):(t.style.display="none",a.classList.add("filtered-out"))}v()},v=()=>{Array.from(t).filter(e=>!e.classList.contains("filtered-out")).forEach((e,t)=>{const a=e;a.style.opacity="0",a.style.transform="translateY(20px)",requestAnimationFrame(()=>{setTimeout(()=>{a.style.transition="opacity 0.3s ease, transform 0.3s ease",a.style.opacity="1",a.style.transform="translateY(0)"},50*t)})})};r&&l&&initializeSearchFilter(r,l),i&&o&&initializeTagFilter(i,o),initializeTagButtons(e,c,g,y),n&&initializeClearButton(n,m,y),d?initializeSearchInput(d,u,y):!0===window.isPreview&&console.warn("Search input element not found")});
